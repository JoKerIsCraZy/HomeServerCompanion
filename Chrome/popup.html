<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Home Server Companion</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <div class="app-container">
    <!-- Sidebar -->
    <nav class="sidebar">
      <div class="nav-item active" data-target="sabnzbd" title="SABnzbd">
        <img src="icons/sabnzbd.png" class="nav-icon" alt="SABnzbd">
      </div>
      <div class="nav-item" data-target="sonarr" title="Sonarr">
        <img src="icons/sonarr.png" class="nav-icon" alt="Sonarr">
      </div>
      <div class="nav-item" data-target="radarr" title="Radarr">
        <img src="icons/radarr.png" class="nav-icon" alt="Radarr">
      </div>
      <div class="nav-item" data-target="tautulli" title="Tautulli">
        <img src="icons/tautulli.png" class="nav-icon" alt="Tautulli">
      </div>
      <div class="nav-item" data-target="overseerr" title="Overseerr">
        <img src="icons/overseerr.png" alt="Overseerr" class="nav-icon" />
      </div>
      <div class="nav-item" data-target="unraid" title="Unraid">
        <img src="icons/unraid.png" class="nav-icon" alt="Unraid">
      </div>
      <div class="spacer"></div>
      <div class="nav-item settings-btn" id="settings-btn" title="Settings">
        <div class="icon-placeholder settings-icon">‚öôÔ∏è</div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="content-area">
      <!-- Header -->
      <header id="main-header">
        <h1 id="page-title">SABnzbd</h1>
        <div id="header-actions">
           <button id="open-link-btn" title="Open Web Interface" style="background:none; border:none; cursor:pointer; margin-right:15px; color:var(--text-secondary); display:flex; align-items:center;">
             <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
               <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
               <polyline points="15 3 21 3 21 9"></polyline>
               <line x1="10" y1="14" x2="21" y2="3"></line>
             </svg>
           </button>
           <button id="theme-toggle" title="Toggle Dark Mode">üåô</button>
        </div>
      </header>
      
      <!-- Error Message -->
      <div id="error-msg" class="error-banner hidden"></div>

      <!-- Views -->
      <div id="sabnzbd-view" class="view active">
        <!-- SABnzbd Status Dashboard -->
        <div class="card" id="sab-status-card">
            <div class="card-row">
                <div class="stat-box">
                    <div class="stat-label">Speed</div>
                    <div class="stat-value" id="sab-speed">0 KB/s</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Remaining</div>
                    <div class="stat-value" id="sab-timeleft">00:00:00</div>
                </div>
                <div class="stat-box">
                     <button id="sab-pause-btn" class="action-btn">‚è∏Ô∏è</button>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" data-tab="queue">Queue</button>
            <button class="tab-btn" data-tab="history">History</button>
        </div>
        <div class="sub-view active" id="sab-queue"></div>
        <div class="sub-view hidden" id="sab-history"></div>
      </div>

      <div id="sonarr-view" class="view hidden">
        <div class="tabs">
            <button class="tab-btn active" data-tab="calendar">Calendar</button>
            <button class="tab-btn" data-tab="history">Recent</button>
            <button class="tab-btn" data-tab="queue">Queue</button>
        </div>
         <div class="sub-view active" id="sonarr-calendar"></div>
         <div class="sub-view hidden" id="sonarr-history"></div>
         <div class="sub-view hidden" id="sonarr-queue"></div>
      </div>

      <div id="radarr-view" class="view hidden">
        <div class="tabs">
            <button class="tab-btn active" data-tab="calendar">Calendar</button>
            <button class="tab-btn" data-tab="movies">Recent</button>
            <button class="tab-btn" data-tab="queue">Queue</button>
        </div>
        <div class="sub-view active" id="radarr-calendar"></div>
        <div class="sub-view hidden" id="radarr-movies"></div>
        <div class="sub-view hidden" id="radarr-queue"></div>
      </div>

      <div id="tautulli-view" class="view hidden">
        <h2 class="fancy-header">Current Activity</h2>
        <div id="tautulli-activity"></div>
      </div>

      <!-- Overseerr View -->
      <div id="overseerr-view" class="view hidden">
        <div class="overseerr-header">
            <div class="sub-tabs">
                <button class="sub-tab-btn active" data-target="overseerr-requests-tab">Requests</button>
                <button class="sub-tab-btn" data-target="overseerr-search-tab">Search</button>
            </div>
        </div>

        <!-- Requests Tab -->
        <div id="overseerr-requests-tab" class="overseerr-tab-content active">
             <div class="filter-bar" style="margin-bottom: 15px; display: flex; justify-content: flex-end; align-items: center;">
                 <select id="overseerr-filter" style="padding: 6px; border-radius: 6px; border: 1px solid var(--text-secondary); background: var(--card-bg); color: var(--text-primary); font-size: 13px; cursor: pointer;">
                     <option value="pending" selected>Pending Approval</option>
                     <option value="approved">Approved</option>
                     <option value="processing">Processing</option>
                     <option value="available">Available</option>
                     <option value="all">All Requests</option>
                 </select>
             </div>
             <div id="overseerr-requests" class="grid-container">
                <!-- Populated by JS -->
             </div>
        </div>

        <!-- Search Tab -->
        <div id="overseerr-search-tab" class="overseerr-tab-content">
            <div class="search-bar">
                <input type="text" id="overseerr-search-input" placeholder="Search Movies & TV...">
                <button id="overseerr-search-btn">üîç</button>
            </div>
            <div id="overseerr-search-results" class="grid-container">
                <!-- Results -->
            </div>
        </div>
      </div>

      <div id="unraid-view" class="view hidden">
        <div class="status-card" id="unraid-status-card">
            <div class="status-indicator">Checking...</div>
            <div class="server-name">Unraid Server</div>
            <div class="server-url" id="unraid-url-display"></div>
        </div>
        
        <!-- Sub Tabs -->
        <div class="sub-tabs">
            <button class="sub-tab-btn active" data-target="unraid-tab-system">System</button>
            <button class="sub-tab-btn" data-target="unraid-tab-storage">Storage</button>
            <button class="sub-tab-btn" data-target="unraid-tab-docker">Docker</button>
        </div>

        <!-- 1. System Tab -->
        <div id="unraid-tab-system" class="sub-view">
             <!-- Populated dynamically by JS to match "Genau so" screenshot -->
        </div>

        <!-- 2. Storage Tab -->
        <div id="unraid-tab-storage" class="sub-view hidden">
            <div class="storage-card">
                 <div class="storage-header" id="storage-toggle" style="cursor: pointer; display: flex; justify-content: space-between;">
                     <div style="display: flex; align-items: center; gap: 10px;">
                         <div class="storage-icon"></div>
                         <span>Array</span>
                     </div>
                     <div class="dropdown-arrow" style="transition: transform 0.3s;">‚ñº</div>
                 </div>
                 <div class="storage-usage-text" id="unraid-storage-text">-- used of --</div>
                 <div class="progress-track" style="margin-bottom: 10px;">
                     <div class="progress-fill" id="unraid-storage-bar" style="width: 0%"></div>
                 </div>
                 
                 <!-- Hidden Details List -->
                 <div id="storage-details-dropdown" class="hidden" style="margin-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px;">
                    <!-- Populated by JS -->
                 </div>
            </div>
        </div>

        <!-- 3. Docker Tab -->
        <div id="unraid-tab-docker" class="sub-view hidden">
            <div class="docker-controls">
                <h3>Containers</h3>
                <div id="unraid-docker-list"></div>
            </div>
        </div>

    </main>
  </div>

  <!-- Templates -->
  <template id="sab-queue-item">
    <div class="card queue-item">
      <div class="card-header">
        <span class="filename">Title</span>
        <!-- Delete Button -->
        <button class="delete-btn" title="Remove from Queue">√ó</button>
      </div>
      <div class="card-row" style="justify-content:space-between; margin-bottom: 5px;">
         <span class="percentage">0%</span>
      </div>
      <div class="progress-bar">
        <div class="progress-bar-fill"></div>
      </div>
      <div class="card-footer">
        <span class="size">0 MB / 0 MB</span>
        <span class="status">Downloading</span>
      </div>
    </div>
  </template>

  <template id="sab-history-item">
    <div class="card history-item">
      <div class="card-header">
         <span class="filename">Title</span>
         <span class="status-badge">Completed</span>
      </div>
      <div class="card-details">
         <span class="size">1.2 GB</span>
         <span class="time">2 mins ago</span>
      </div>
    </div>
  </template>

  <template id="tautulli-card">
    <div class="card tautulli-item" style="padding: 0; overflow: hidden; position: relative; min-height: 120px; border: none;">
        <!-- Background Image -->
        <div class="tautulli-backdrop" style="position: absolute; top:0; left:0; width: 100%; height: 100%; background-size: cover; background-position: center; filter: blur(2px) brightness(0.3); z-index: 1;"></div>
        
        <div class="tautulli-content" style="position: relative; z-index: 2; padding: 12px; display: flex; gap: 15px; align-items: center;">
            <!-- Poster -->
            <div class="tautulli-poster" style="width: 60px; height: 90px; background: #333; border-radius: 4px; overflow: hidden; flex-shrink:0; box-shadow: 0 4px 6px rgba(0,0,0,0.3);">
                <img class="poster-img" src="" style="width: 100%; height: 100%; object-fit: cover;">
            </div>
            
            <!-- Info -->
            <div class="tautulli-info" style="flex: 1; color: white; display: flex; flex-direction: column; justify-content: center;">
                <div class="media-title" style="font-size: 16px; font-weight: 700; margin-bottom: 4px; text-shadow: 0 1px 2px rgba(0,0,0,0.8);">Title</div>
                <div class="user-info" style="font-size: 13px; opacity: 0.9; margin-bottom: 8px; display: flex; align-items: center; gap: 6px;">
                     <span class="user-name">User</span>
                     <span class="stream-details" style="font-size: 11px; opacity: 0.7; background: rgba(255,255,255,0.1); padding: 1px 4px; border-radius: 3px;">Details</span>
                </div>
                
                <div class="progress-bar" style="background: rgba(255,255,255,0.2); height: 4px; margin-bottom: 6px;">
                    <div class="progress-bar-fill" style="background: var(--accent-sab);"></div>
                </div>
                 <div class="state" style="font-size: 11px; text-transform: uppercase; font-weight: 600; opacity: 0.8;">Playing</div>
            </div>

            <!-- Kill Button -->
            <button class="kill-btn" title="Kill Stream" style="background: rgba(244,67,54,0.2); border: 1px solid rgba(244,67,54,0.5); color: #f44336; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s;">
                <span style="font-size: 14px; font-weight: bold;">‚úï</span>
            </button>
        </div>
    </div>
  </template>

  <template id="docker-card">
    <div class="docker-item">
        <div style="display: flex; align-items: center; gap: 12px;">
            <div class="status-dot" style="width: 10px; height: 10px; border-radius: 50%; background: #ccc;"></div>
            <div class="docker-info">
                <div class="docker-name" style="font-weight: 600; font-size: 14px;">Container Name</div>
                <div class="docker-image" style="font-size: 11px; color: var(--text-secondary);">Image</div>
            </div>
        </div>
        <div class="docker-controls" style="display: flex; gap: 8px;">
            <button class="control-btn start-btn" title="Start">‚ñ∂</button>
            <button class="control-btn restart-btn" title="Restart">‚Üª</button>
            <button class="control-btn stop-btn" title="Stop">‚èπ</button>
        </div>
    </div>
  </template>

  <template id="media-card">
    <div class="card media-item">
        <div class="card-row">
            <div class="media-info">
                <div class="media-title">Title</div>
                <div class="media-meta">Season 1 - Ep 1</div>
            </div>
            <div class="media-status">
                <span class="status-badge">Airing</span>
            </div>
        </div>
        <div class="card-row date-row">
            <span class="air-date">Today</span>
        </div>
    </div>
  </template>

  <template id="activity-card">
    <div class="card activity-item">
        <div class="card-row">
             <div class="user-info">User</div>
             <div class="state">Playing</div>
        </div>
        <div class="media-title">Movie Title</div>
        <div class="progress-container">
            <div class="progress-bar-fill"></div>
        </div>
    </div>
  </template>

    <!-- Overseerr Card Template -->
    <template id="overseerr-card">
        <div class="overseerr-card">
            <div class="overseerr-backdrop"></div>
            <div class="overseerr-content">
                <img class="poster-img" src="" alt="Poster">
                <div class="overseerr-info">
                    <div class="media-title">Title</div>
                    <div class="request-info">
                        <span class="requester-name">User</span> ¬∑ <span class="request-date">Date</span>
                    </div>
                    <div class="request-status">Pending Approval</div>
                </div>
                <div class="overseerr-actions">
                    <button class="action-btn approve-btn" title="Approve">‚úî</button>
                    <button class="action-btn decline-btn" title="Decline">‚úñ</button>
                </div>
            </div>
        </div>
    </template>

    <!-- Overseerr Search Card Template -->
    <template id="overseerr-search-card">
        <div class="overseerr-card">
            <div class="overseerr-backdrop"></div>
            <div class="overseerr-content">
                <img class="poster-img" src="" alt="Poster">
                <div class="overseerr-info">
                    <div class="media-title">Title</div>
                    <div class="request-info">
                        <span class="media-year">Year</span> ¬∑ <span class="media-type">Type</span>
                    </div>
                    <div class="search-status-container"></div> 
                </div>
                <div class="overseerr-actions">
                    <button class="action-btn request-btn" title="Request">‚ûï</button>
                </div>
            </div>
        </div>
    </template>

  <script type="module" src="js/popup.js"></script>
</body>
</html>
